<?xml version="1.0" encoding="UTF-8"?>
   <!DOCTYPE mapper
     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
     
<mapper namespace="com.spring.mvc_mybatis.ch03.dao.UserDAO_ch03"> 
   
   <!-- 1. 동적 SQL -->
   <!-- 작성자 john, 글제목 "", 글내용 LIKE '%반복문%' 검색 -->
   <!-- 공통 -->
   <resultMap id="userMap" type="com.spring.mvc_mybatis.ch03.dto.UserDTO_3">
      <id property="userId" column="user_id" />
      <result property="userName" column="user_name" />
      <result property="regDate" column="reg_date" />
      <collection property="boardDTO" columnPrefix="board_"  ofType="com.spring.mvc_mybatis.ch03.dto.BoardDTO_3">
         <result property="boardNum" column="num" /> 
         <result property="boardTitle" column="title" /> 
         <result property="boardContent" column="content" /> 
      
      </collection>
   </resultMap>
   <select id="getSearchInfo_1" parameterType="com.spring.mvc_mybatis.ch03.dto.SearchDTO_3" resultMap="userMap">
      SELECT u.user_id, 
             u.user_name, 
             u.reg_date,  
             b.board_num,
             b.board_title,
             b.board_content
        FROM mvc_user_tbl u
           , mvc_board_tbl b
       WHERE u.user_id = b.user_id
         AND u.user_name = #{userName}
         <if test="boardDTO != null and !boardDTO.boardTitle.isEmpty()">
         AND b.board_title LIKE '%' || #{boardDTO.boardTitle} || '%'
         </if>
          <if test="boardDTO != null and boardDTO.boardContent != null">
         AND b.board_content LIKE '%' || #{boardDTO.boardContent} || '%'
         </if>
       ORDER BY u.user_id ASC
   </select>
   
   <!-- 2. 동적 SQL -->
   <!-- 작성자 john, 글제목 "", 글내용 LIKE '%반복문%' 검색 -->
   <select id="getSearchInfo_2" parameterType="com.spring.mvc_mybatis.ch03.dto.SearchDTO_3" resultMap="userMap">
      SELECT u.user_id, 
             u.user_name, 
             u.reg_date,  
             b.board_num,
             b.board_title,
             b.board_content
        FROM mvc_user_tbl u
           , mvc_board_tbl b
       WHERE u.user_id = b.user_id
         AND u.user_name = #{userName}
         <if test="boardDTO != null and boardDTO.boardTitle != null">
         AND b.board_title LIKE '%' || #{boardDTO.boardTitle} || '%'
         </if>
          <if test="boardDTO != null and boardDTO.boardContent != null">
         AND b.board_content LIKE '%' || #{boardDTO.boardContent} || '%'
         </if>
       ORDER BY u.user_id ASC
   </select>
   
   <!-- 3. 동적 SQL -->
   <!-- 작성자 null, 글제목 null, 글내용 LIKE '%활용%' 검색 -->
   <select id="getSearchInfo_3" parameterType="com.spring.mvc_mybatis.ch03.dto.SearchDTO_3" resultMap="userMap">
      SELECT u.user_id, 
             u.user_name, 
             u.reg_date,  
             b.board_num,
             b.board_title,
             b.board_content
        FROM mvc_user_tbl u
           , mvc_board_tbl b
       WHERE u.user_id = b.user_id
          <if test="userName != null">
            AND u.user_name = #{userName}
          </if>
            <if test="boardDTO != null and boardDTO.boardTitle != null">
           AND b.board_title LIKE '%' || #{boardDTO.boardTitle} || '%'
            </if>
             <if test="boardDTO != null and boardDTO.boardContent != null">
            AND b.board_content LIKE '%' || #{boardDTO.boardContent} || '%'
            </if>
       ORDER BY u.user_id ASC
   </select>
   
   <update id="updateUser" parameterType="com.spring.mvc_mybatis.ch03.dto.UserDTO_3">
      UPDATE mvc_user_tbl
      <set>
         <if test="userName != null">user_name = #{userName},</if>
         <if test="regDate != null">reg_date = #{regDate},</if>
      </set>
      WHERE user_id = #{userId}
   </update>
   
   <select id="getUserSearchInfo" parameterType="String" resultType="com.spring.mvc_mybatis.ch03.dto.UserDTO_3">
      SELECT user_id userId, 
             user_name userName, 
             reg_date regDate 
        FROM mvc_user_tbl 
          <if test="_parameter != null and _parameter.equals('john')">
            WHERE user_name = #{userName}
           </if>
   </select>
</mapper> 