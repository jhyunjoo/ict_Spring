<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	  
	 <mapper namespace="com.spring.mvc_mybatis.ch02.dao.UserDAO_ch02">  <!-- namespace="패키지명.인터페이스" -->
		<!-- 일대다 매핑 : collection -->
		<!-- 방법1. collection - resultMap => join문 -->
		
		<!-- 1-1. user정보, board 정보 -->
		<select id="getBoardInfo_1" resultMap="userMap1">
			SELECT u.user_id, 
			       u.user_name, 
			       u.reg_date,  
			       b.board_num,
			       b.board_title,
			       b.board_content
			  FROM mvc_user_tbl u
			     , mvc_board_tbl b
			 WHERE u.user_id = b.user_id
			 ORDER BY u.user_id ASC
		</select>
		
		<!-- 1-2. 매핑 -->
		<resultMap id="userMap1" type="com.spring.mvc_mybatis.ch02.dto.UserDTO_2">
			<id property="userId" column="user_id"/>	<!-- pk -->
			<result property="userName" column="user_name"/>
			<result property="regDate" column="reg_date"/>
			<collection property="boardDTO" column="user_id" resultMap="getBoard"/>	<!-- fk -->
		</resultMap>
		
		<!-- 1-3. board 정보 -->
		<resultMap id="getBoard" type="com.spring.mvc_mybatis.ch02.dto.BoardDTO_2">
			<result property="boardNum" column="board_num"/>
			<result property="boardTitle" column="board_title"/>
			<result property="boardContent" column="board_content"/>
		</resultMap>
		
		<!-- 방법2. collection - select 문장 분리 -->
		
		<!-- 2-1. user 정보 -->
		<select id="getBoardInfo_2" resultMap="userMap2">
			SELECT user_id, 
			       user_name, 
			       reg_date  
			  FROM mvc_user_tbl
		</select>
		
		<!-- 2-2. 매핑 -->
		<resultMap id="userMap2" type="com.spring.mvc_mybatis.ch02.dto.UserDTO_2">
			<id property="userId" column="user_id"/>	<!-- pk -->
			<result property="userName" column="user_name"/>
			<result property="regDate" column="reg_date"/>
			<collection property="boardDTO" column="user_id" select="getBoard2"/>	<!-- fk -->
		</resultMap>
		
		<!-- 2-3. board 정보 -->
		<select id="getBoard2" resultType="com.spring.mvc_mybatis.ch02.dto.BoardDTO_2">
			SELECT board_num as boardNum
				 , board_title as boardTitle
				 , board_content as boardContent
			  FROM mvc_board_tbl
			 WHERE user_id = #{user_id}		<!-- WHERE fk = pk -->
		</select>
		
	</mapper> 